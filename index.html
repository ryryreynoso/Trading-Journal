<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-orientation=portrait">
    <title>Trading Journal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

```
    html {
        background: #000;
    }

    body {
        font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #000;
        color: #fff;
        overflow-x: hidden;
        position: fixed;
        width: 100%;
        height: 100%;
    }

    /* Header */
    .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #000;
        padding: 15px 15px 0;
        z-index: 100;
        border-bottom: none;
    }

    .balance-display {
        text-align: center;
        margin-bottom: 5px;
        background: #000;
    }

    .balance-amount {
        font-size: 36px;
        font-weight: 800;
        color: #fff;
        letter-spacing: -1px;
    }

    .balance-change {
        font-size: 14px;
        margin-top: 5px;
        font-weight: 600;
    }

    .balance-change.positive {
        color: #00ff88;
    }

    .balance-change.negative {
        color: #ff4444;
    }

    .header-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0;
        padding: 12px 0 0;
        position: relative;
        background: #000;
        width: 100%;
    }

    .view-indicator {
        display: flex;
        align-items: center;
        justify-content: space-evenly;
        width: 100%;
        padding: 0;
    }

    .view-icon {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        opacity: 0.35;
        transition: opacity 0.15s ease;
        cursor: pointer;
        color: #fff;
        flex-shrink: 0;
    }

    .view-icon.active {
        opacity: 1;
    }

    .add-btn {
        position: fixed;
        bottom: 30px;
        right: 20px;
        background: #fff;
        border: none;
        color: #000;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        font-size: 32px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.3s;
        font-weight: 400;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .add-btn:active {
        transform: scale(0.95);
        opacity: 0.8;
    }

    .add-btn:active {
        transform: scale(0.95);
        opacity: 0.8;
    }

    /* Main Content Area */
    .content-wrapper {
        position: fixed;
        top: 105px;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        background: #000;
    }

    /* Debug Panel */
    .debug-panel {
        position: fixed;
        bottom: 80px;
        left: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.95);
        border: 1px solid #262626;
        border-radius: 12px;
        padding: 12px;
        font-size: 11px;
        font-family: monospace;
        z-index: 9999;
        max-height: 200px;
        overflow-y: auto;
    }

    .debug-row {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        border-bottom: 1px solid #1a1a1a;
    }

    .debug-row:last-child {
        border-bottom: none;
    }

    .debug-label {
        color: #8e8e8e;
        font-weight: 600;
    }

    .debug-value {
        color: #fff;
        text-align: right;
        word-break: break-all;
        max-width: 60%;
    }

    .debug-value.success {
        color: #00ff88;
    }

    .debug-value.error {
        color: #ff4444;
    }

    .debug-toggle {
        position: fixed;
        bottom: 20px;
        left: 10px;
        background: #262626;
        color: #fff;
        border: 1px solid #3a3a3a;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 600;
        z-index: 10000;
        cursor: pointer;
    }

    .content-wrapper::-webkit-scrollbar {
        display: none;
    }

    /* Feed View */
    .feed-view {
        min-width: 100vw;
        width: 100vw;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        scroll-snap-align: start;
        -webkit-overflow-scrolling: touch;
        background: #000;
    }

    .scroll-feed {
        display: flex;
        flex-direction: column;
        gap: 0;
        padding: 15px;
        background: #000;
    }

    .entry-card {
        background: #000;
        overflow: hidden;
        transition: all 0.2s;
        border: 0.5px solid #262626;
        border-radius: 16px;
        position: relative;
        box-shadow: none;
        margin-bottom: 15px;
    }

    .entry-card.correct {
        border-left: 3px solid #00ff88;
        border-radius: 16px;
    }

    .entry-card.wrong {
        border-left: 3px solid #ff4444;
        border-radius: 16px;
    }

    .entry-card::after {
        display: none;
    }

    .entry-card:last-child::after {
        display: none;
    }

    .entry-header {
        padding: 16px 18px;
        border-bottom: 0.5px solid #262626;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .entry-edit-btn {
        background: transparent;
        border: none;
        color: #fff;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        flex-shrink: 0;
    }

    .entry-edit-btn:active {
        opacity: 0.5;
    }

    .entry-edit-btn svg {
        stroke: currentColor;
    }

    .entry-date {
        font-size: 13px;
        color: #8e8e8e;
        font-weight: 600;
        letter-spacing: 0.3px;
    }

    .entry-symbol {
        font-size: 22px;
        font-weight: 900;
        color: #fff;
        letter-spacing: -0.5px;
    }

    .entry-images {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }

    .entry-images::-webkit-scrollbar {
        display: none;
    }

    .entry-image {
        width: 100%;
        min-width: 100%;
        aspect-ratio: 1;
        object-fit: cover;
        background: #000;
        scroll-snap-align: start;
    }

    .image-dots {
        display: flex;
        justify-content: center;
        gap: 6px;
        padding: 12px 0;
        background: #000;
    }

    .image-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #262626;
        transition: all 0.3s;
    }

    .image-dot.active {
        background: #fff;
        width: 6px;
        border-radius: 50%;
        box-shadow: none;
    }

    .entry-details {
        padding: 16px 18px;
    }

    .entry-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 14px;
    }

    .entry-label {
        color: #8e8e8e;
        font-weight: 600;
        letter-spacing: 0.3px;
    }

    .entry-value {
        color: #fff;
        font-weight: 700;
        letter-spacing: 0.2px;
    }

    .balance-row {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 0.5px solid #262626;
        font-size: 17px;
        font-weight: 800;
    }

    .entry-notes {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 0.5px solid #262626;
        font-size: 14px;
        color: #f5f5f5;
        line-height: 1.6;
        font-weight: 400;
    }

    /* Grid View */
    .grid-view {
        min-width: 100vw;
        width: 100vw;
        height: 100%;
        overflow-y: auto;
        scroll-snap-align: start;
        -webkit-overflow-scrolling: touch;
        padding: 0;
        background: #000;
    }

    .grid-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1px;
        padding: 0;
        background: #000;
    }

    .grid-item {
        aspect-ratio: 1;
        background: #000;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s;
        border-radius: 0;
        border: 0.5px solid #000;
    }

    .grid-item:active {
        opacity: 0.8;
    }

    .grid-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .grid-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
        padding: 12px;
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.5px;
    }

    /* Calendar View */
    .calendar-view {
        min-width: 100vw;
        width: 100vw;
        height: 100%;
        overflow-y: auto;
        scroll-snap-align: start;
        -webkit-overflow-scrolling: touch;
        padding: 0;
        background: #000;
    }

    /* Notes View */
    .notes-view {
        min-width: 100vw;
        width: 100vw;
        height: 100%;
        overflow-y: auto;
        scroll-snap-align: start;
        -webkit-overflow-scrolling: touch;
        padding: 0;
        display: flex;
        flex-direction: column;
        background: #000;
    }

    /* Reversal Patterns View */
    .reversals-view {
        min-width: 100vw;
        width: 100vw;
        height: 100%;
        overflow-y: auto;
        scroll-snap-align: start;
        -webkit-overflow-scrolling: touch;
        padding: 0;
        display: flex;
        flex-direction: column;
        background: #000;
    }

    .reversals-header {
        padding: 20px 15px 0;
        margin-bottom: 20px;
    }

    .reversals-title {
        font-size: 28px;
        font-weight: 800;
        letter-spacing: -0.5px;
        color: #fff;
    }

    .reversals-container {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 20px;
        padding: 0 15px;
        background: #000;
    }

    .reversal-item {
        background: #000;
        border: 1px solid #262626;
        border-radius: 14px;
        margin-bottom: 15px;
        overflow: hidden;
    }

    .reversal-header {
        padding: 14px;
        border-bottom: 1px solid #262626;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .reversal-date {
        font-size: 14px;
        color: #8e8e8e;
        font-weight: 600;
    }

    .reversal-delete {
        background: transparent;
        border: none;
        color: #8e8e8e;
        font-size: 20px;
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .reversal-delete:active {
        color: #fff;
        opacity: 0.5;
    }

    .reversal-image {
        width: 100%;
        display: block;
        background: #000;
    }

    .reversal-notes {
        padding: 14px;
        color: #f5f5f5;
        font-size: 15px;
        line-height: 1.5;
        word-wrap: break-word;
    }

    .reversals-add-container {
        padding: 0 15px 20px;
        background: #000;
    }

    .reversals-add-btn {
        width: 100%;
        background: #fff;
        border: none;
        color: #000;
        padding: 16px;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
    }

    .reversals-add-btn:active {
        opacity: 0.8;
    }

    .empty-reversals {
        text-align: center;
        padding: 60px 20px;
        color: #8e8e8e;
    }

    .empty-reversals-icon {
        font-size: 70px;
        margin-bottom: 20px;
        opacity: 0.6;
    }

    .notes-header {
        margin-bottom: 20px;
        padding: 20px 15px 0;
    }

    .notes-title {
        font-size: 28px;
        font-weight: 800;
        letter-spacing: -0.5px;
        color: #fff;
    }

    .notes-container {
        flex: 1;
        overflow-y: auto;
        overflow-x: visible;
        margin-bottom: 20px;
        background: #000;
        padding: 0 15px;
    }

    .note-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 14px;
        margin-bottom: 10px;
        background: #000;
        border: 1px solid #262626;
        border-radius: 14px;
        transition: all 0.3s;
        overflow: visible;
    }

    .note-item:active {
        opacity: 0.8;
    }

    .note-bullet {
        color: #fff;
        font-size: 20px;
        font-weight: 700;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .note-content {
        flex: 1;
        color: #fff;
        font-size: 15px;
        line-height: 1.5;
        word-wrap: break-word;
    }

    .note-delete {
        background: transparent;
        border: none;
        color: #8e8e8e;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 18px;
        font-weight: 700;
        transition: all 0.3s;
        flex-shrink: 0;
    }

    .note-delete:active {
        color: #fff;
        opacity: 0.5;
    }

    .notes-input-container {
        display: flex;
        gap: 10px;
        padding: 0 15px 20px;
    }

    .notes-input {
        flex: 1;
        background: #000;
        border: 1px solid #262626;
        color: #fff;
        padding: 14px 16px;
        border-radius: 14px;
        font-size: 16px;
        transition: all 0.3s;
        font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-weight: 500;
    }

    .notes-input:focus {
        outline: none;
        border-color: #8e8e8e;
        background: #000;
        box-shadow: none;
    }

    .notes-add-btn {
        background: #fff;
        border: none;
        color: #000;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 30px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
        transition: all 0.3s;
        font-weight: 400;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .notes-add-btn:active {
        transform: scale(0.95);
        opacity: 0.8;
    }

    .empty-notes {
        text-align: center;
        padding: 60px 20px;
        color: #8e8e8e;
    }

    .empty-notes-icon {
        font-size: 70px;
        margin-bottom: 20px;
        opacity: 0.6;
    }

    .calendar-header {
        text-align: center;
        margin-bottom: 20px;
        padding: 20px 15px 0;
    }

    .calendar-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
    }

    .calendar-arrow {
        background: #000;
        border: 1px solid #262626;
        color: #fff;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 300;
    }

    .calendar-arrow:active {
        opacity: 0.5;
    }

    .calendar-month {
        font-size: 26px;
        font-weight: 800;
        letter-spacing: -0.5px;
        flex: 1;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 30px;
        padding: 0 15px 20px;
    }

    .calendar-day-header {
        text-align: center;
        font-size: 11px;
        color: rgba(0, 168, 255, 0.7);
        padding: 5px;
        font-weight: 700;
        letter-spacing: 0.5px;
    }

    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #000;
        border-radius: 14px;
        font-size: 14px;
        position: relative;
        cursor: pointer;
        border: 1px solid #262626;
        transition: all 0.3s;
    }

    .calendar-day.has-trade {
        border: 1px solid #fff;
    }

    .calendar-day.profit {
        background: rgba(0, 255, 136, 0.08);
        border-color: #00ff88;
    }

    .calendar-day.loss {
        background: rgba(255, 68, 68, 0.08);
        border-color: #ff4444;
    }

    .calendar-day-number {
        font-weight: 800;
    }

    .calendar-day-pnl {
        font-size: 9px;
        margin-top: 2px;
        font-weight: 700;
    }

    .calendar-day-pnl.positive {
        color: #00ff88;
    }

    .calendar-day-pnl.negative {
        color: #ff4444;
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #000;
        z-index: 200;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .modal.active {
        display: block;
    }

    .modal-content {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .modal-title {
        font-size: 26px;
        font-weight: 800;
        letter-spacing: -0.5px;
    }

    .close-btn {
        background: transparent;
        border: none;
        color: #8e8e8e;
        font-size: 24px;
        cursor: pointer;
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        font-weight: 300;
    }

    .close-btn:hover {
        color: #fff;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        margin-bottom: 10px;
        color: #8e8e8e;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .form-input {
        width: 100%;
        background: #000;
        border: 1px solid #262626;
        color: #fff;
        padding: 14px 16px;
        border-radius: 14px;
        font-size: 16px;
        transition: all 0.3s;
        font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-weight: 500;
    }

    .form-input:focus {
        outline: none;
        border-color: #8e8e8e;
        background: #000;
        box-shadow: none;
    }

    textarea.form-input {
        resize: vertical;
        min-height: 100px;
    }

    .radio-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .radio-option {
        flex: 1;
        min-width: 70px;
    }

    .radio-option input[type="radio"] {
        display: none;
    }

    .radio-option label {
        display: block;
        padding: 11px 18px;
        background: #000;
        border: 1px solid #262626;
        border-radius: 25px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
        font-weight: 700;
        letter-spacing: 0.3px;
    }

    .radio-option input[type="radio"]:checked + label {
        background: #fff;
        color: #000;
        border-color: #fff;
    }

    .bubble-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .bubble-option {
        padding: 11px 20px;
        background: #000;
        border: 1px solid #262626;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
        font-weight: 700;
        user-select: none;
        letter-spacing: 0.3px;
    }

    .bubble-option:hover {
        background: #000;
        border-color: #8e8e8e;
    }

    .bubble-option.active {
        background: #fff;
        color: #000;
        border-color: #fff;
    }

    .image-upload {
        border: 2px dashed #262626;
        border-radius: 18px;
        padding: 32px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background: #000;
    }

    .image-upload:hover {
        border-color: #8e8e8e;
        background: #000;
    }

    .image-upload input {
        display: none;
    }

    .image-preview-item {
        position: relative;
        width: 100px;
        height: 100px;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid rgba(0, 149, 255, 0.4);
    }

    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .image-preview-delete {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 68, 68, 0.95);
        border: none;
        color: #fff;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .submit-btn {
        width: 100%;
        background: #fff;
        border: none;
        color: #000;
        padding: 17px;
        border-radius: 14px;
        font-size: 18px;
        font-weight: 800;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
        transition: all 0.3s;
        letter-spacing: 0.5px;
    }

    .submit-btn:active {
        transform: scale(0.98);
        opacity: 0.8;
    }

    .delete-btn {
        width: 100%;
        background: transparent;
        border: 1px solid #ff4444;
        color: #ff4444;
        padding: 17px;
        border-radius: 14px;
        font-size: 18px;
        font-weight: 800;
        cursor: pointer;
        margin-top: 15px;
        box-shadow: 0 8px 24px rgba(255, 68, 68, 0.5);
        transition: all 0.3s;
        letter-spacing: 0.5px;
    }

    .delete-btn:active {
        transform: scale(0.98);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #8e8e8e;
    }

    .empty-state-icon {
        font-size: 70px;
        margin-bottom: 20px;
        opacity: 0.6;
    }

    /* Loading animation */
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .loading {
        animation: pulse 1.5s ease-in-out infinite;
    }

    /* Smooth scroll */
    .feed-view {
        scroll-behavior: smooth;
    }

    /* Better touch feedback */
    .entry-card:active,
    .grid-item:active,
    .toggle-btn:active,
    .add-btn:active,
    .bubble-option:active,
    .submit-btn:active {
        opacity: 0.9;
    }

    @media (max-width: 400px) {
        .balance-amount {
            font-size: 24px;
        }
    }
</style>
```

</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="balance-display">
            <div class="balance-amount" id="totalBalance">$0</div>
            <div class="balance-change" id="balanceChange"></div>
        </div>
        <div class="header-controls">
            <div class="view-indicator">
                <div class="view-icon active" data-view="scroll" onclick="scrollToView(0)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <rect x="3" y="3" width="7" height="7" rx="1"/>
                        <rect x="3" y="14" width="7" height="7" rx="1"/>
                        <line x1="14" y1="4" x2="21" y2="4"/>
                        <line x1="14" y1="8" x2="21" y2="8"/>
                        <line x1="14" y1="15" x2="21" y2="15"/>
                        <line x1="14" y1="19" x2="21" y2="19"/>
                    </svg>
                </div>
                <div class="view-icon" data-view="grid" onclick="scrollToView(1)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <rect x="3" y="3" width="7" height="7" rx="1"/>
                        <rect x="14" y="3" width="7" height="7" rx="1"/>
                        <rect x="3" y="14" width="7" height="7" rx="1"/>
                        <rect x="14" y="14" width="7" height="7" rx="1"/>
                    </svg>
                </div>
                <div class="view-icon" data-view="calendar" onclick="scrollToView(2)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <rect x="3" y="4" width="18" height="18" rx="2"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                    </svg>
                </div>
                <div class="view-icon" data-view="notes" onclick="scrollToView(3)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="9" y1="13" x2="15" y2="13"/>
                        <line x1="9" y1="17" x2="15" y2="17"/>
                    </svg>
                </div>
                <div class="view-icon" data-view="reversals" onclick="scrollToView(4)">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <polyline points="7,13 12,8 17,13"/>
                        <polyline points="17,11 12,16 7,11"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

```
<!-- Content Wrapper -->
<div class="content-wrapper" id="contentWrapper">
    <!-- Feed View (Scroll) -->
    <div class="feed-view">
        <div class="scroll-feed" id="scrollFeed">
            <div class="empty-state">
                <div class="empty-state-icon">üìä</div>
                <p>No journal entries yet</p>
                <p style="margin-top: 10px; font-size: 14px;">Tap + to add your first trade</p>
            </div>
        </div>
    </div>

    <!-- Grid View -->
    <div class="grid-view" id="gridView">
        <div class="grid-container" id="gridContainer"></div>
    </div>

    <!-- Calendar View -->
    <div class="calendar-view" id="calendarView">
        <div class="calendar-header">
            <div class="calendar-nav">
                <button class="calendar-arrow" onclick="changeMonth(-1)">‚Üê</button>
                <div class="calendar-month" id="calendarMonth">January 2026</div>
                <button class="calendar-arrow" onclick="changeMonth(1)">‚Üí</button>
            </div>
        </div>
        <div id="calendarContainer"></div>
    </div>

    <!-- Notes View -->
    <div class="notes-view" id="notesView">
        <div class="notes-header">
            <h2 class="notes-title">Trading Notes</h2>
        </div>
        <div class="notes-container" id="notesContainer">
            <!-- Notes will be dynamically added here -->
        </div>
        <div class="notes-input-container">
            <input type="text" class="notes-input" id="notesInput" placeholder="Add a note..." />
            <button class="notes-add-btn" onclick="addNote()">+</button>
        </div>
    </div>

    <!-- Reversal Patterns View -->
    <div class="reversals-view" id="reversalsView">
        <div class="reversals-header">
            <h2 class="reversals-title">Reversal Patterns</h2>
        </div>
        <div class="reversals-container" id="reversalsContainer">
            <div class="empty-reversals">
                <div class="empty-reversals-icon">üîÑ</div>
                <p>No reversal patterns yet</p>
                <p style="margin-top: 10px; font-size: 14px;">Add your first pattern below</p>
            </div>
        </div>
        <div class="reversals-add-container">
            <button class="reversals-add-btn" onclick="openReversalModal()">+ Add Reversal Pattern</button>
        </div>
    </div>
</div>

<!-- Debug Panel -->
<div id="debugPanel" class="debug-panel"></div>
<button id="debugToggle" class="debug-toggle" onclick="toggleDebugPanel()">üêõ Show Debug</button>

<!-- Floating Add Button -->
<button class="add-btn" onclick="openModal()">+</button>
```

<!-- Add Entry Modal -->

```
<div class="modal" id="entryModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">New Trade Entry</div>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>

        <form id="entryForm">
            <div class="form-group">
                <label class="form-label">Symbol</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="symbolES" name="symbol" value="ES" checked>
                        <label for="symbolES">ES</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="symbolNQ" name="symbol" value="NQ">
                        <label for="symbolNQ">NQ</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Date & Time</label>
                <div style="display: flex; gap: 10px;">
                    <input type="date" class="form-input" id="entryDate" required style="flex: 1;">
                    <input type="time" class="form-input" id="entryTime" required style="flex: 1;">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Fair Value Gap Timeframe</label>
                <div class="bubble-group" id="fvgGroup">
                    <div class="bubble-option" data-value="5m">5m</div>
                    <div class="bubble-option" data-value="15m">15m</div>
                    <div class="bubble-option" data-value="1h">1h</div>
                    <div class="bubble-option" data-value="D">D</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Fibonacci Level</label>
                <div class="bubble-group" id="fibGroup">
                    <div class="bubble-option" data-value="0.5">0.5</div>
                    <div class="bubble-option" data-value="0.618">0.618</div>
                    <div class="bubble-option" data-value="0.786">0.786</div>
                    <div class="bubble-option" data-value="GP">GP</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Volume Profile Level</label>
                <div class="bubble-group" id="vpGroup">
                    <div class="bubble-option" data-value="VAL">VAL</div>
                    <div class="bubble-option" data-value="VAH">VAH</div>
                    <div class="bubble-option" data-value="POC">POC</div>
                    <div class="bubble-option" data-value="PVAL">PVAL</div>
                    <div class="bubble-option" data-value="PVAH">PVAH</div>
                    <div class="bubble-option" data-value="PPOC">PPOC</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">1m Market Structure Entry?</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="msYes" name="marketStructure" value="Yes">
                        <label for="msYes">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="msNo" name="marketStructure" value="No" checked>
                        <label for="msNo">No</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Analysis Result</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="analysisResult" id="resultCorrect" value="Correct">
                        <label for="resultCorrect">‚úì Correct</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="analysisResult" id="resultWrong" value="Wrong">
                        <label for="resultWrong">‚úó Wrong</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="analysisResult" id="resultNone" value="None" checked>
                        <label for="resultNone">‚Äî</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Upload Screenshots</label>
                <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                    <input type="file" id="imageInput" accept="image/*" multiple>
                    <div id="imageUploadText">üì∏ Tap to upload images</div>
                </div>
                <div id="imagePreviewContainer" style="display: none; margin-top: 15px;">
                    <div id="imagePreviews" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Account Balance (Optional)</label>
                <input type="number" class="form-input" id="balance" placeholder="48000" step="0.01">
            </div>

            <div class="form-group">
                <label class="form-label">Notes (Optional)</label>
                <textarea class="form-input" id="notes" rows="4" placeholder="Additional trade notes, thoughts, or observations..."></textarea>
            </div>

            <button type="submit" class="submit-btn">Save Entry</button>
        </form>
    </div>
</div>

<script type="module">
    // Firebase Configuration
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, doc, setDoc, deleteDoc, getDocs, query, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAygHXlc-L9WVDxO6I-C0NLNKzFAgBRAzg",
        authDomain: "trading-journal-b1734.firebaseapp.com",
        projectId: "trading-journal-b1734",
        storageBucket: "trading-journal-b1734.firebasestorage.app",
        messagingSenderId: "271809620729",
        appId: "1:271809620729:web:c70b1e8ec857cf9dc8d028"
    };

    // Initialize Firebase
    window.app = null;
    window.auth = null;
    window.db = null;
    window.currentUser = null;
    window.useFirebase = false;

    if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
        try {
            window.app = initializeApp(firebaseConfig);
            window.auth = getAuth(window.app);
            window.db = getFirestore(window.app);
            window.useFirebase = true;
            debugInfo.firebaseInitialized = true;
            console.log("‚úÖ Firebase initialized successfully");
            updateDebugPanel();
            
            // Sign in anonymously
            signInAnonymously(window.auth).then(() => {
                debugInfo.authEnabled = true;
                console.log("‚úÖ Signed in anonymously");
                showFirebaseStatus('connected');
                updateDebugPanel();
            }).catch(error => {
                console.error("‚ùå Auth error:", error);
                debugInfo.errors.push("Auth: " + error.message);
                window.useFirebase = false;
                showFirebaseStatus('error');
                updateDebugPanel();
            });

            // Listen for auth state changes
            onAuthStateChanged(window.auth, (user) => {
                if (user) {
                    window.currentUser = user;
                    debugInfo.userId = user.uid;
                    console.log("‚úÖ User authenticated:", user.uid);
                    updateDebugPanel();
                    loadEntriesFromFirebase();
                }
            });
        } catch (error) {
            console.error("‚ùå Firebase initialization error:", error);
            debugInfo.errors.push("Init: " + error.message);
            window.useFirebase = false;
            showFirebaseStatus('error');
            updateDebugPanel();
        }
    }

    // Show Firebase status indicator
    function showFirebaseStatus(status) {
        const indicator = document.createElement('div');
        indicator.style.cssText = `
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 6px;
        `;
        
        if (status === 'connected') {
            indicator.style.background = 'rgba(0, 255, 136, 0.2)';
            indicator.style.color = '#00ff88';
            indicator.innerHTML = 'üî• Cloud Sync ON';
        } else {
            indicator.style.background = 'rgba(255, 68, 68, 0.2)';
            indicator.style.color = '#ff4444';
            indicator.innerHTML = '‚ö†Ô∏è Local Only';
        }
        
        document.body.appendChild(indicator);
        
        // Auto-hide after 3 seconds
        setTimeout(() => {
            indicator.style.opacity = '0';
            indicator.style.transition = 'opacity 0.5s';
            setTimeout(() => indicator.remove(), 500);
        }, 3000);
    }

    // Make Firebase functions available globally
    window.setDoc = setDoc;
    window.deleteDoc = deleteDoc;
    window.doc = doc;
    window.collection = collection;
    window.query = query;
    window.orderBy = orderBy;
    window.onSnapshot = onSnapshot;
</script>

<script>
    // Password Protection - Enter once and never again
    // Safe because GitHub repo is private
    const APP_PASSWORD = "trading2025"; // Change this to your desired password
    
    function checkAccess() {
        const savedAuth = localStorage.getItem('trading-journal-authenticated');
        
        // If already authenticated, allow access
        if (savedAuth === 'true') {
            return true;
        }
        
        // Otherwise, prompt for password
        const password = prompt('üîí Enter password to access Trading Journal:');
        
        if (password === APP_PASSWORD) {
            localStorage.setItem('trading-journal-authenticated', 'true');
            return true;
        } else if (password === null) {
            // User clicked cancel
            document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #000; color: #8e8e8e; font-size: 18px;">Access cancelled</div>';
            return false;
        } else {
            // Wrong password
            alert('‚ùå Incorrect password');
            document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #000; color: #ff4444; font-size: 18px;">Access Denied</div>';
            return false;
        }
    }
    
    // Check access immediately
    if (!checkAccess()) {
        throw new Error('Access denied');
    }

    // Data variables
    let entries = [];
    let currentView = 'scroll';
    let touchStartX = 0;
    let touchEndX = 0;
    let currentSwipeView = 'feed';
    let editingEntryId = null;
    let uploadedImages = [];
    let currentCalendarMonth = new Date();
    let notes = [];
    let reversals = [];

    // Debug state
    let debugInfo = {
        firebaseInitialized: false,
        authEnabled: false,
        userId: null,
        lastSaveAttempt: null,
        lastSaveResult: null,
        lastLoadAttempt: null,
        lastLoadResult: null,
        entriesCount: 0,
        errors: []
    };

    function updateDebugPanel() {
        const panel = document.getElementById('debugPanel');
        if (!panel) return;

        panel.innerHTML = `
            <div class="debug-row">
                <span class="debug-label">Firebase Init:</span>
                <span class="debug-value ${debugInfo.firebaseInitialized ? 'success' : 'error'}">
                    ${debugInfo.firebaseInitialized ? '‚úÖ YES' : '‚ùå NO'}
                </span>
            </div>
            <div class="debug-row">
                <span class="debug-label">Auth Enabled:</span>
                <span class="debug-value ${debugInfo.authEnabled ? 'success' : 'error'}">
                    ${debugInfo.authEnabled ? '‚úÖ YES' : '‚ùå NO'}
                </span>
            </div>
            <div class="debug-row">
                <span class="debug-label">User ID:</span>
                <span class="debug-value ${debugInfo.userId ? 'success' : 'error'}">
                    ${debugInfo.userId ? debugInfo.userId.substring(0, 20) + '...' : 'None'}
                </span>
            </div>
            <div class="debug-row">
                <span class="debug-label">Entries Count:</span>
                <span class="debug-value">${debugInfo.entriesCount}</span>
            </div>
            <div class="debug-row">
                <span class="debug-label">Last Save:</span>
                <span class="debug-value ${debugInfo.lastSaveResult === 'success' ? 'success' : debugInfo.lastSaveResult === 'failed' ? 'error' : ''}">
                    ${debugInfo.lastSaveAttempt || 'Never'} - ${debugInfo.lastSaveResult || 'N/A'}
                </span>
            </div>
            <div class="debug-row">
                <span class="debug-label">Last Load:</span>
                <span class="debug-value ${debugInfo.lastLoadResult === 'success' ? 'success' : debugInfo.lastLoadResult === 'failed' ? 'error' : ''}">
                    ${debugInfo.lastLoadAttempt || 'Never'} - ${debugInfo.lastLoadResult || 'N/A'}
                </span>
            </div>
            ${debugInfo.errors.length > 0 ? `
                <div class="debug-row">
                    <span class="debug-label">Last Error:</span>
                    <span class="debug-value error">${debugInfo.errors[debugInfo.errors.length - 1]}</span>
                </div>
            ` : ''}
        `;
    }

    function toggleDebugPanel() {
        const panel = document.getElementById('debugPanel');
        const btn = document.getElementById('debugToggle');
        if (panel.style.display === 'none') {
            panel.style.display = 'block';
            btn.textContent = 'üêõ Hide Debug';
        } else {
            panel.style.display = 'none';
            btn.textContent = 'üêõ Show Debug';
        }
    }


    // Bubble selector functionality
    function setupBubbleSelectors() {
        // FVG - single selection (changed from multiple)
        const fvgGroup = document.getElementById('fvgGroup');
        fvgGroup.querySelectorAll('.bubble-option').forEach(bubble => {
            bubble.addEventListener('click', function() {
                fvgGroup.querySelectorAll('.bubble-option').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Fib - single selection (no default)
        const fibGroup = document.getElementById('fibGroup');
        fibGroup.querySelectorAll('.bubble-option').forEach(bubble => {
            bubble.addEventListener('click', function() {
                fibGroup.querySelectorAll('.bubble-option').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // VP - single selection (changed from multiple)
        const vpGroup = document.getElementById('vpGroup');
        vpGroup.querySelectorAll('.bubble-option').forEach(bubble => {
            bubble.addEventListener('click', function() {
                vpGroup.querySelectorAll('.bubble-option').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });
    }

    // Load data from localStorage
    function loadData() {
        if (window.useFirebase && window.currentUser) {
            // Data will be loaded by Firebase listener
            return;
        }
        
        // Load from localStorage
        const saved = localStorage.getItem('tradingJournal');
        if (saved) {
            entries = JSON.parse(saved);
            entries.sort((a, b) => {
                const dateCompare = new Date(b.date) - new Date(a.date);
                if (dateCompare !== 0) return dateCompare;
                return (b.time || '').localeCompare(a.time || '');
            });
            updateDisplay();
        }
    }

    // Save data to localStorage or Firebase
    async function saveData() {
        // Always save to localStorage first as backup
        localStorage.setItem('tradingJournal', JSON.stringify(entries));
        
        // Then try Firebase
        if (window.useFirebase && window.currentUser) {
            await saveToFirebase();
        }
    }

    async function saveToFirebase() {
        if (!window.useFirebase || !window.currentUser) {
            console.log("‚ö†Ô∏è Firebase not available, using localStorage only");
            debugInfo.lastSaveAttempt = new Date().toLocaleTimeString();
            debugInfo.lastSaveResult = 'skipped (no firebase)';
            updateDebugPanel();
            return;
        }
        
        try {
            debugInfo.lastSaveAttempt = new Date().toLocaleTimeString();
            debugInfo.entriesCount = entries.length;
            console.log(`üíæ Saving ${entries.length} entries to Firebase...`);
            // Save each entry as a document
            for (const entry of entries) {
                const docRef = window.doc(window.db, 'users', window.currentUser.uid, 'entries', entry.id.toString());
                await window.setDoc(docRef, entry);
            }
            console.log("‚úÖ Successfully saved to Firebase");
            debugInfo.lastSaveResult = 'success';
            updateDebugPanel();
        } catch (error) {
            console.error('‚ùå Error saving to Firebase:', error);
            debugInfo.lastSaveResult = 'failed';
            debugInfo.errors.push("Save: " + error.message);
            updateDebugPanel();
            // Fallback to localStorage
            localStorage.setItem('tradingJournal', JSON.stringify(entries));
        }
    }

    async function loadEntriesFromFirebase() {
        if (!window.useFirebase || !window.currentUser) {
            console.log("‚ö†Ô∏è Firebase not available, loading from localStorage");
            debugInfo.lastLoadAttempt = new Date().toLocaleTimeString();
            debugInfo.lastLoadResult = 'skipped (no firebase)';
            updateDebugPanel();
            return;
        }
        
        try {
            debugInfo.lastLoadAttempt = new Date().toLocaleTimeString();
            console.log("üì• Loading entries from Firebase...");
            const entriesRef = window.collection(window.db, 'users', window.currentUser.uid, 'entries');
            const q = window.query(entriesRef, window.orderBy('date', 'desc'));
            
            // Real-time listener
            window.onSnapshot(q, (snapshot) => {
                entries = [];
                snapshot.forEach((doc) => {
                    entries.push(doc.data());
                });
                entries.sort((a, b) => {
                    const dateCompare = new Date(b.date) - new Date(a.date);
                    if (dateCompare !== 0) return dateCompare;
                    return (b.time || '').localeCompare(a.time || '');
                });
                console.log(`‚úÖ Loaded ${entries.length} entries from Firebase`);
                debugInfo.lastLoadResult = 'success';
                debugInfo.entriesCount = entries.length;
                updateDebugPanel();
                updateDisplay();
            });
        } catch (error) {
            console.error('Error loading from Firebase:', error);
            debugInfo.lastLoadResult = 'failed';
            debugInfo.errors.push("Load: " + error.message);
            updateDebugPanel();
            // Fallback to localStorage
            loadData();
        }
    }

    async function deleteFromFirebase(entryId) {
        if (!window.useFirebase || !window.currentUser) return;
        
        try {
            const docRef = window.doc(window.db, 'users', window.currentUser.uid, 'entries', entryId.toString());
            await window.deleteDoc(docRef);
        } catch (error) {
            console.error('Error deleting from Firebase:', error);
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        loadData();
        loadNotes();
        updateDebugPanel();
        document.getElementById('debugPanel').style.display = 'none'; // Hidden by default
        const today = new Date().toISOString().split('T')[0];
        const now = new Date();
        const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        document.getElementById('entryDate').value = today;
        document.getElementById('entryTime').value = currentTime;
        setupBubbleSelectors();
        setupScrollDetection();
        updateCalendar();
    });

    // Instagram-style scroll detection
    function setupScrollDetection() {
        const contentWrapper = document.getElementById('contentWrapper');
        const icons = document.querySelectorAll('.view-icon');
        
        contentWrapper.addEventListener('scroll', function() {
            const scrollLeft = this.scrollLeft;
            const width = this.offsetWidth;
            const currentIndex = Math.round(scrollLeft / width);
            
            // Update icons
            icons.forEach((icon, i) => {
                if (i === currentIndex) {
                    icon.classList.add('active');
                } else {
                    icon.classList.remove('active');
                }
            });
        });
    }

    function scrollToView(index) {
        const contentWrapper = document.getElementById('contentWrapper');
        const width = contentWrapper.offsetWidth;
        contentWrapper.scrollTo({
            left: width * index,
            behavior: 'auto'
        });
    }

    // Image upload preview
    document.getElementById('imageInput').addEventListener('change', function(e) {
        const files = Array.from(e.target.files);
        
        if (files.length === 0) return;
        
        // Process files one by one to avoid errors
        let processed = 0;
        
        files.forEach((file, index) => {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        uploadedImages.push(e.target.result);
                        processed++;
                        if (processed === files.length) {
                            updateImagePreviews();
                        }
                    } catch (error) {
                        console.error('Error processing image:', error);
                    }
                };
                reader.onerror = function(error) {
                    console.error('Error reading file:', error);
                    processed++;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Reset input
        this.value = '';
    });

    function updateImagePreviews() {
        const container = document.getElementById('imagePreviewContainer');
        const previews = document.getElementById('imagePreviews');
        
        if (uploadedImages.length > 0) {
            container.style.display = 'block';
            document.getElementById('imageUploadText').textContent = `üì∏ ${uploadedImages.length} image(s) selected - Tap to add more`;
            
            previews.innerHTML = uploadedImages.map((img, index) => `
                <div class="image-preview-item">
                    <img src="${img}" alt="Preview ${index + 1}">
                    <button class="image-preview-delete" onclick="removeImage(${index})" type="button">√ó</button>
                </div>
            `).join('');
        } else {
            container.style.display = 'none';
            document.getElementById('imageUploadText').textContent = 'üì∏ Tap to upload images';
        }
    }

    function removeImage(index) {
        uploadedImages.splice(index, 1);
        updateImagePreviews();
    }

    // Form submission
    document.getElementById('entryForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        try {
            const symbol = document.querySelector('input[name="symbol"]:checked')?.value || 'ES';
            const date = document.getElementById('entryDate').value;
            const time = document.getElementById('entryTime').value;
            const balanceInput = document.getElementById('balance').value;
            const balance = balanceInput ? parseFloat(balanceInput) : null;
            const notes = document.getElementById('notes').value.trim();
            
            if (!date || !time) {
                alert('Please fill in the date and time');
                return;
            }
            
            // Get FVG timeframe from bubble (single selection) - optional
            const fvgBubble = document.getElementById('fvgGroup').querySelector('.bubble-option.active');
            const fvgTimeframe = fvgBubble ? fvgBubble.dataset.value : null;
            
            // Get Fib from bubbles - optional
            const fibBubble = document.getElementById('fibGroup').querySelector('.bubble-option.active');
            const fib = fibBubble ? fibBubble.dataset.value : null;
            
            // Get VP level from bubble (single selection) - optional
            const vpBubble = document.getElementById('vpGroup').querySelector('.bubble-option.active');
            const vpLevel = vpBubble ? vpBubble.dataset.value : null;
            
            const marketStructure = document.querySelector('input[name="marketStructure"]:checked')?.value || 'No';
            const analysisResult = document.querySelector('input[name="analysisResult"]:checked')?.value || 'None';
            
            // Use uploaded images array
            const images = [...uploadedImages];
            
            if (editingEntryId) {
                // Update existing entry
                const index = entries.findIndex(e => e.id === editingEntryId);
                if (index !== -1) {
                    entries[index] = {
                        ...entries[index],
                        symbol,
                        date,
                        time,
                        fvgTimeframe,
                        fib,
                        vpLevel,
                        marketStructure,
                        analysisResult,
                        images,
                        balance,
                        notes
                    };
                }
                editingEntryId = null;
            } else {
                // Create new entry
                const entry = {
                    id: Date.now(),
                    symbol,
                    date,
                    time,
                    fvgTimeframe,
                    fib,
                    vpLevel,
                    marketStructure,
                    analysisResult,
                    images,
                    balance,
                    notes
                };
                entries.unshift(entry);
            }
            
            entries.sort((a, b) => {
                const dateCompare = new Date(b.date) - new Date(a.date);
                if (dateCompare !== 0) return dateCompare;
                return (b.time || '').localeCompare(a.time || '');
            });
            await saveData();
            updateDisplay();
            closeModal();
            resetForm();
        } catch (error) {
            console.error('Error saving entry:', error);
            alert('Error saving entry. Please try again.');
        }
    });

    function resetForm() {
        document.getElementById('entryForm').reset();
        uploadedImages = [];
        updateImagePreviews();
        document.getElementById('symbolES').checked = true;
        
        // Clear all bubble selections
        document.querySelectorAll('.bubble-option').forEach(b => b.classList.remove('active'));
        
        // Update modal title
        document.querySelector('.modal-title').textContent = 'New Trade Entry';
        
        // Remove delete button if exists
        const existingDeleteBtn = document.getElementById('deleteEntryBtn');
        if (existingDeleteBtn) {
            existingDeleteBtn.remove();
        }
    }

    function updateDisplay() {
        updateBalanceDisplay();
        updateScrollFeed();
        updateGridView();
        updateCalendar();
    }

    function updateBalanceDisplay() {
        const totalBalanceEl = document.getElementById('totalBalance');
        const balanceChangeEl = document.getElementById('balanceChange');
        
        // Find the most recent entry with a balance
        const entriesWithBalance = entries.filter(e => e.balance != null);
        
        if (entriesWithBalance.length === 0) {
            totalBalanceEl.textContent = '$0';
            balanceChangeEl.textContent = '';
            return;
        }
        
        const currentBalance = entriesWithBalance[0].balance;
        totalBalanceEl.textContent = '$' + currentBalance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        
        if (entriesWithBalance.length > 1) {
            const previousBalance = entriesWithBalance[1].balance;
            const change = currentBalance - previousBalance;
            const changePercent = ((change / previousBalance) * 100).toFixed(2);
            
            balanceChangeEl.className = 'balance-change ' + (change >= 0 ? 'positive' : 'negative');
            balanceChangeEl.textContent = (change >= 0 ? '+' : '') + '$' + change.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' (' + changePercent + '%)';
        } else {
            balanceChangeEl.textContent = '';
        }
    }

    function updateScrollFeed() {
        const scrollFeed = document.getElementById('scrollFeed');
        
        if (entries.length === 0) {
            scrollFeed.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìä</div>
                    <p>No journal entries yet</p>
                    <p style="margin-top: 10px; font-size: 14px;">Tap + to add your first trade</p>
                </div>
            `;
            return;
        }
        
        scrollFeed.innerHTML = entries.map(entry => {
            // Handle both old single image format and new multiple images format
            const images = entry.images || (entry.image ? [entry.image] : []);
            
            // Handle both old array format and new single value format
            const fvgDisplay = entry.fvgTimeframe || (entry.fvgTimeframes && entry.fvgTimeframes.length > 0 ? entry.fvgTimeframes.join(', ') : null);
            const vpDisplay = entry.vpLevel || (entry.vpLevels && entry.vpLevels.length > 0 ? entry.vpLevels.join(', ') : null);
            
            return `
            <div class="entry-card ${entry.analysisResult === 'Correct' ? 'correct' : entry.analysisResult === 'Wrong' ? 'wrong' : ''}">
                <div class="entry-header">
                    <div class="entry-date">${formatDate(entry.date, entry.time)}</div>
                    <div class="entry-symbol">${entry.symbol}</div>
                    <button class="entry-edit-btn" onclick="editEntry(${entry.id}); event.stopPropagation();">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                    </button>
                </div>
                ${images.length > 0 ? `
                    <div class="entry-images" id="images-${entry.id}">
                        ${images.map(img => `<img src="${img}" class="entry-image" alt="Trade screenshot">`).join('')}
                    </div>
                    ${images.length > 1 ? `
                    <div class="image-dots" id="dots-${entry.id}">
                        ${images.map((_, i) => `<div class="image-dot ${i === 0 ? 'active' : ''}"></div>`).join('')}
                    </div>
                    ` : ''}
                ` : ''}
                <div class="entry-details">
                    ${fvgDisplay ? `
                    <div class="entry-row">
                        <span class="entry-label">FVG Timeframe:</span>
                        <span class="entry-value">${fvgDisplay}</span>
                    </div>
                    ` : ''}
                    ${entry.fib ? `
                    <div class="entry-row">
                        <span class="entry-label">Fibonacci:</span>
                        <span class="entry-value">${entry.fib}</span>
                    </div>
                    ` : ''}
                    ${vpDisplay ? `
                    <div class="entry-row">
                        <span class="entry-label">Volume Profile:</span>
                        <span class="entry-value">${vpDisplay}</span>
                    </div>
                    ` : ''}
                    <div class="entry-row">
                        <span class="entry-label">1m Market Structure:</span>
                        <span class="entry-value">${entry.marketStructure}</span>
                    </div>
                    ${entry.notes ? `
                    <div class="entry-notes">${entry.notes}</div>
                    ` : ''}
                    ${entry.balance != null ? `
                    <div class="entry-row balance-row">
                        <span class="entry-label">Balance:</span>
                        <span class="entry-value">$${entry.balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                    </div>
                    ` : ''}
                </div>
            </div>
        `}).join('');
        
        // Setup image scroll listeners for dots
        entries.forEach(entry => {
            const images = entry.images || (entry.image ? [entry.image] : []);
            if (images.length > 1) {
                const container = document.getElementById(`images-${entry.id}`);
                const dotsContainer = document.getElementById(`dots-${entry.id}`);
                
                if (container && dotsContainer) {
                    container.addEventListener('scroll', function() {
                        const scrollLeft = this.scrollLeft;
                        const width = this.offsetWidth;
                        const currentIndex = Math.round(scrollLeft / width);
                        
                        const dots = dotsContainer.querySelectorAll('.image-dot');
                        dots.forEach((dot, i) => {
                            if (i === currentIndex) {
                                dot.classList.add('active');
                            } else {
                                dot.classList.remove('active');
                            }
                        });
                    });
                }
            }
        });
    }

    function updateGridView() {
        const gridContainer = document.getElementById('gridContainer');
        
        if (entries.length === 0) {
            gridContainer.innerHTML = '';
            return;
        }
        
        gridContainer.innerHTML = entries.map(entry => {
            // Handle both old single image format and new multiple images format
            const images = entry.images || (entry.image ? [entry.image] : []);
            const firstImage = images.length > 0 ? images[0] : null;
            
            return `
            <div class="grid-item" onclick="editEntry(${entry.id})">
                ${firstImage ? `<img src="${firstImage}" alt="${entry.symbol} trade">` : `<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 24px; color: rgba(0, 168, 255, 0.5);">üìä</div>`}
                <div class="grid-overlay">
                    <div>${entry.symbol}</div>
                    <div style="font-size: 10px; color: rgba(0, 168, 255, 0.7);">${formatDate(entry.date, entry.time)}</div>
                </div>
            </div>
        `}).join('');
    }

    function updateCalendar() {
        const container = document.getElementById('calendarContainer');
        const monthDisplay = document.getElementById('calendarMonth');
        
        // Update month display
        monthDisplay.textContent = currentCalendarMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
        
        // Generate single month
        container.innerHTML = generateMonthCalendar(currentCalendarMonth);
    }

    function changeMonth(direction) {
        // direction: -1 for previous month, 1 for next month
        currentCalendarMonth = new Date(currentCalendarMonth.getFullYear(), currentCalendarMonth.getMonth() + direction, 1);
        updateCalendar();
    }

    function generateMonthCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // Create a sorted list of entries by date
        const sortedEntries = [...entries].sort((a, b) => new Date(a.date) - new Date(b.date));
        
        // Calculate P&L for each day by comparing with previous entry
        const dailyPnL = {};
        for (let i = 0; i < sortedEntries.length; i++) {
            const currentEntry = sortedEntries[i];
            const currentDate = currentEntry.date;
            
            if (i > 0) {
                const previousEntry = sortedEntries[i - 1];
                const change = currentEntry.balance - previousEntry.balance;
                dailyPnL[currentDate] = change;
            }
        }
        
        let html = `
            <div class="calendar-grid">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
        `;
        
        // Empty cells before first day
        for (let i = 0; i < firstDay; i++) {
            html += '<div></div>';
        }
        
        // Days of month
        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const pnl = dailyPnL[dateStr];
            const hasTrade = pnl !== undefined;
            const isProfit = hasTrade && pnl > 0;
            const isLoss = hasTrade && pnl < 0;
            
            html += `
                <div class="calendar-day ${hasTrade ? 'has-trade' : ''} ${isProfit ? 'profit' : ''} ${isLoss ? 'loss' : ''}">
                    <div class="calendar-day-number">${day}</div>
                    ${hasTrade ? `<div class="calendar-day-pnl ${pnl >= 0 ? 'positive' : 'negative'}">${pnl >= 0 ? '+' : ''}$${Math.abs(pnl).toFixed(0)}</div>` : ''}
                </div>
            `;
        }
        
        html += '</div>';
        return html;
    }

    function formatDate(dateStr, timeStr) {
        const date = new Date(dateStr + 'T00:00:00');
        const dateFormatted = date.toLocaleDateString('en-US', { 
            weekday: 'short', 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        });
        
        if (timeStr) {
            // Convert 24hr time to 12hr format
            const [hours, minutes] = timeStr.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${dateFormatted} ‚Ä¢ ${hour12}:${minutes} ${ampm}`;
        }
        
        return dateFormatted;
    }

    // Modal functions
    function openModal() {
        editingEntryId = null;
        document.getElementById('entryModal').classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        editingEntryId = null;
        document.getElementById('entryModal').classList.remove('active');
        document.body.style.overflow = '';
    }

    function editEntry(entryId) {
        const entry = entries.find(e => e.id === entryId);
        if (!entry) return;
        
        editingEntryId = entryId;
        
        // Update modal title
        document.querySelector('.modal-title').textContent = 'Edit Trade Entry';
        
        // Fill form with entry data
        document.querySelector(`input[name="symbol"][value="${entry.symbol}"]`).checked = true;
        document.getElementById('entryDate').value = entry.date;
        document.getElementById('entryTime').value = entry.time || '09:30';
        document.getElementById('balance').value = entry.balance != null ? entry.balance : '';
        document.getElementById('notes').value = entry.notes || '';
        
        // Set FVG bubble (single selection)
        const fvgValue = entry.fvgTimeframe || (entry.fvgTimeframes && entry.fvgTimeframes[0]);
        document.getElementById('fvgGroup').querySelectorAll('.bubble-option').forEach(bubble => {
            if (fvgValue && bubble.dataset.value === fvgValue) {
                bubble.classList.add('active');
            } else {
                bubble.classList.remove('active');
            }
        });
        
        // Set Fib bubble
        document.getElementById('fibGroup').querySelectorAll('.bubble-option').forEach(bubble => {
            if (entry.fib && bubble.dataset.value === entry.fib) {
                bubble.classList.add('active');
            } else {
                bubble.classList.remove('active');
            }
        });
        
        // Set VP bubble (single selection)
        const vpValue = entry.vpLevel || (entry.vpLevels && entry.vpLevels[0]);
        document.getElementById('vpGroup').querySelectorAll('.bubble-option').forEach(bubble => {
            if (vpValue && bubble.dataset.value === vpValue) {
                bubble.classList.add('active');
            } else {
                bubble.classList.remove('active');
            }
        });
        
        // Set market structure
        document.querySelector(`input[name="marketStructure"][value="${entry.marketStructure}"]`).checked = true;
        
        // Set analysis result
        const resultValue = entry.analysisResult || 'None';
        document.querySelector(`input[name="analysisResult"][value="${resultValue}"]`).checked = true;
        
        // Load existing images
        uploadedImages = entry.images || (entry.image ? [entry.image] : []);
        updateImagePreviews();
        
        // Add delete button if not exists
        let deleteBtn = document.getElementById('deleteEntryBtn');
        if (!deleteBtn) {
            deleteBtn = document.createElement('button');
            deleteBtn.id = 'deleteEntryBtn';
            deleteBtn.type = 'button';
            deleteBtn.className = 'delete-btn';
            deleteBtn.textContent = 'Delete Entry';
            deleteBtn.onclick = function() {
                if (confirm('Are you sure you want to delete this entry?')) {
                    deleteEntry(entryId);
                }
            };
            document.getElementById('entryForm').appendChild(deleteBtn);
        }
        
        openModal();
    }

    async function deleteEntry(entryId) {
        entries = entries.filter(e => e.id !== entryId);
        
        // Delete from Firebase if enabled
        if (window.useFirebase && window.currentUser) {
            await deleteFromFirebase(entryId);
        }
        
        await saveData();
        updateDisplay();
        closeModal();
        resetForm();
    }

    // Notes functions
    function loadNotes() {
        const saved = localStorage.getItem('tradingJournalNotes');
        if (saved) {
            try {
                notes = JSON.parse(saved);
                renderNotes();
            } catch (e) {
                console.error('Error loading notes:', e);
                notes = [];
            }
        }
    }

    function saveNotes() {
        localStorage.setItem('tradingJournalNotes', JSON.stringify(notes));
    }

    function addNote() {
        const input = document.getElementById('notesInput');
        const text = input.value.trim();
        
        if (!text) return;
        
        const note = {
            id: Date.now(),
            text: text,
            timestamp: new Date().toISOString()
        };
        
        notes.unshift(note);
        saveNotes();
        renderNotes();
        input.value = '';
    }

    function deleteNote(noteId) {
        notes = notes.filter(n => n.id !== noteId);
        saveNotes();
        renderNotes();
    }

    function renderNotes() {
        const container = document.getElementById('notesContainer');
        
        if (notes.length === 0) {
            container.innerHTML = `
                <div class="empty-notes">
                    <div class="empty-notes-icon">üìù</div>
                    <p>No notes yet</p>
                    <p style="margin-top: 10px; font-size: 14px;">Add your trading insights below</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = notes.map(note => `
            <div class="note-item">
                <div class="note-bullet">‚Ä¢</div>
                <div class="note-content">${escapeHtml(note.text)}</div>
                <button class="note-delete" onclick="deleteNote(${note.id})">√ó</button>
            </div>
        `).join('');
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Allow Enter key to add note
    document.addEventListener('DOMContentLoaded', function() {
        const notesInput = document.getElementById('notesInput');
        if (notesInput) {
            notesInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNote();
                }
            });
        }
    });

    // Reversal Patterns functions
    let reversalImage = null;
    let editingReversalId = null;

    function loadReversals() {
        const saved = localStorage.getItem('tradingJournalReversals');
        if (saved) {
            try {
                reversals = JSON.parse(saved);
                renderReversals();
            } catch (e) {
                console.error('Error loading reversals:', e);
                reversals = [];
            }
        }
    }

    function saveReversals() {
        localStorage.setItem('tradingJournalReversals', JSON.stringify(reversals));
    }

    function openReversalModal() {
        document.getElementById('reversalModal').style.display = 'flex';
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('reversalDate').value = today;
        editingReversalId = null;
    }

    function closeReversalModal() {
        document.getElementById('reversalModal').style.display = 'none';
        document.getElementById('reversalForm').reset();
        reversalImage = null;
        editingReversalId = null;
        document.getElementById('reversalImagePreview').style.display = 'none';
    }

    function handleReversalImage(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                reversalImage = event.target.result;
                const preview = document.getElementById('reversalImagePreview');
                preview.innerHTML = `<img src="${reversalImage}" style="width: 100%; border-radius: 14px;">`;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    function saveReversal() {
        const date = document.getElementById('reversalDate').value;
        const notes = document.getElementById('reversalNotes').value.trim();

        if (!date) {
            alert('Please select a date');
            return;
        }

        const reversal = {
            id: editingReversalId || Date.now(),
            date: date,
            notes: notes,
            image: reversalImage,
            timestamp: new Date().toISOString()
        };

        if (editingReversalId) {
            const index = reversals.findIndex(r => r.id === editingReversalId);
            if (index !== -1) {
                reversals[index] = reversal;
            }
        } else {
            reversals.unshift(reversal);
        }

        reversals.sort((a, b) => new Date(b.date) - new Date(a.date));
        saveReversals();
        renderReversals();
        closeReversalModal();
    }

    function deleteReversal(reversalId) {
        if (confirm('Delete this reversal pattern?')) {
            reversals = reversals.filter(r => r.id !== reversalId);
            saveReversals();
            renderReversals();
        }
    }

    function renderReversals() {
        const container = document.getElementById('reversalsContainer');

        if (reversals.length === 0) {
            container.innerHTML = `
                <div class="empty-reversals">
                    <div class="empty-reversals-icon">üîÑ</div>
                    <p>No reversal patterns yet</p>
                    <p style="margin-top: 10px; font-size: 14px;">Add your first pattern below</p>
                </div>
            `;
            return;
        }

        container.innerHTML = reversals.map(reversal => `
            <div class="reversal-item">
                <div class="reversal-header">
                    <div class="reversal-date">${formatDate(reversal.date)}</div>
                    <button class="reversal-delete" onclick="deleteReversal(${reversal.id})">√ó</button>
                </div>
                ${reversal.image ? `<img src="${reversal.image}" class="reversal-image" alt="Pattern">` : ''}
                ${reversal.notes ? `<div class="reversal-notes">${escapeHtml(reversal.notes)}</div>` : ''}
            </div>
        `).join('');
    }

    // Load reversals on page load
    loadReversals();
</script>

<!-- Reversal Pattern Modal -->
<div class="modal" id="reversalModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Add Reversal Pattern</div>
            <button class="close-btn" onclick="closeReversalModal()">&times;</button>
        </div>

        <form id="reversalForm" onsubmit="event.preventDefault(); saveReversal();">
            <div class="form-group">
                <label class="form-label">Date</label>
                <input type="date" id="reversalDate" class="form-input" required>
            </div>

            <div class="form-group">
                <label class="form-label">Screenshot (Optional)</label>
                <div class="image-upload" onclick="document.getElementById('reversalImageInput').click()">
                    <div style="font-size: 40px; margin-bottom: 10px;">üì∏</div>
                    <div style="color: #8e8e8e; font-weight: 600;">Tap to upload image</div>
                    <input type="file" id="reversalImageInput" accept="image/*" onchange="handleReversalImage(event)" style="display: none;">
                </div>
                <div id="reversalImagePreview" style="display: none; margin-top: 15px;"></div>
            </div>

            <div class="form-group">
                <label class="form-label">Notes (Optional)</label>
                <textarea id="reversalNotes" class="form-input" rows="4" placeholder="Describe the reversal pattern..."></textarea>
            </div>

            <button type="submit" class="submit-btn">Save Pattern</button>
        </form>
    </div>
</div>
```

</body>
</html>